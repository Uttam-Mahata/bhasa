// ভাষা কম্পাইলার - Main Compiler Driver (মূল কম্পাইলার ড্রাইভার)
// CLI ইন্টারফেস এবং সম্পূর্ণ কম্পাইলেশন পাইপলাইন

অন্তর্ভুক্ত "modules/টোকেন";
অন্তর্ভুক্ত "modules/লেক্সার";
অন্তর্ভুক্ত "modules/পার্সার";
অন্তর্ভুক্ত "modules/এএসটি";
অন্তর্ভুক্ত "modules/কম্পাইলার";
অন্তর্ভুক্ত "modules/কোড";
অন্তর্ভুক্ত "modules/মডিউল_লোডার";

// =============== মূল কম্পাইলার ইন্টারফেস ===============

// কম্পাইল_ফাইল - ফাইল কম্পাইল করো
ধরি কম্পাইল_ফাইল = ফাংশন(ফাইল_পথ) {
    লেখ("=== ভাষা স্ব-হোস্টিং কম্পাইলার ===");
    লেখ("ফাইল কম্পাইল করা হচ্ছে: " + ফাইল_পথ);
    লেখ("");
    
    // ফাইল পড়ো
    লেখ("১. ফাইল পড়া হচ্ছে...");
    ধরি ফাইল_ফলাফল = ফাইল_পড়ো(ফাইল_পথ);
    যদি (!ফাইল_ফলাফল["সফল"]) {
        লেখ("❌ ত্রুটি: ফাইল পড়তে ব্যর্থ - " + ফাইল_পথ);
        ফেরত {"সফল": মিথ্যা, "ত্রুটি": "ফাইল পড়তে ব্যর্থ"};
    }
    
    ধরি সোর্স_কোড = ফাইল_ফলাফল["বিষয়বস্তু"];
    লেখ("✓ ফাইল সফলভাবে পড়া হয়েছে (" + লেখা(দৈর্ঘ্য(সোর্স_কোড)) + " অক্ষর)");
    
    // লেক্সিক্যাল বিশ্লেষণ (Lexical Analysis)
    লেখ("");
    লেখ("২. লেক্সিক্যাল বিশ্লেষণ (টোকেনাইজেশন)...");
    ধরি লেক্সার = নতুন_লেক্সার(সোর্স_কোড);
    ধরি সব_টোকেন_ফলাফল = সব_টোকেন_করো(লেক্সার);
    ধরি টোকেন_তালিকা = সব_টোকেন_ফলাফল["টোকেন"];
    
    লেখ("✓ " + লেখা(দৈর্ঘ্য(টোকেন_তালিকা)) + " টি টোকেন তৈরি হয়েছে");
    
    // পার্সিং (Parsing)
    লেখ("");
    লেখ("৩. সিনট্যাক্স বিশ্লেষণ (পার্সিং)...");
    লেক্সার = নতুন_লেক্সার(সোর্স_কোড);  // নতুন লেক্সার তৈরি করো
    ধরি পার্সার = নতুন_পার্সার(লেক্সার);
    ধরি পার্স_ফলাফল = পার্স_প্রোগ্রাম(পার্সার);
    
    পার্সার = পার্স_ফলাফল["পার্সার"];
    ধরি প্রোগ্রাম = পার্স_ফলাফল["প্রোগ্রাম"];
    
    // পার্সিং ত্রুটি পরীক্ষা করো
    যদি (দৈর্ঘ্য(পার্সার["ত্রুটি"]) > ০) {
        লেখ("❌ পার্সিং ত্রুটি:");
        পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(পার্সার["ত্রুটি"]); i = i + ১) {
            লেখ("  - " + পার্সার["ত্রুটি"][i]);
        }
        ফেরত {"সফল": মিথ্যা, "ত্রুটি": "পার্সিং ত্রুটি"};
    }
    
    লেখ("✓ AST সফলভাবে তৈরি হয়েছে (" + লেখা(দৈর্ঘ্য(প্রোগ্রাম["বিবৃতি"])) + " টি বিবৃতি)");
    
    // কম্পাইলেশন (Compilation)
    লেখ("");
    লেখ("৪. বাইটকোড কম্পাইলেশন...");
    ধরি কম্পাইলার = নতুন_কম্পাইলার();
    ধরি কম্পাইল_ফলাফল = কম্পাইল(কম্পাইলার, প্রোগ্রাম);
    
    যদি (!কম্পাইল_ফলাফল["সফল"]) {
        লেখ("❌ কম্পাইল ত্রুটি: " + কম্পাইল_ফলাফল["ত্রুটি"]);
        ফেরত {"সফল": মিথ্যা, "ত্রুটি": কম্পাইল_ফলাফল["ত্রুটি"]};
    }
    
    কম্পাইলার = কম্পাইল_ফলাফল["কম্পাইলার"];
    
    // বাইটকোড নিষ্কাশন
    ধরি বাইটকোড = বাইটকোড_পাও(কম্পাইলার);
    
    লেখ("✓ বাইটকোড সফলভাবে তৈরি হয়েছে");
    লেখ("  - নির্দেশ: " + লেখা(দৈর্ঘ্য(বাইটকোড["নির্দেশ"])) + " বাইট");
    লেখ("  - ধ্রুবক: " + লেখা(দৈর্ঘ্য(বাইটকোড["ধ্রুবক"])) + " টি");
    
    // কম্পাইলেশন সম্পন্ন
    লেখ("");
    লেখ("✅ কম্পাইলেশন সফল!");
    
    ফেরত {
        "সফল": সত্য,
        "বাইটকোড": বাইটকোড,
        "টোকেন_সংখ্যা": দৈর্ঘ্য(টোকেন_তালিকা),
        "বিবৃতি_সংখ্যা": দৈর্ঘ্য(প্রোগ্রাম["বিবৃতি"]),
        "নির্দেশ_সংখ্যা": দৈর্ঘ্য(বাইটকোড["নির্দেশ"]),
        "ধ্রুবক_সংখ্যা": দৈর্ঘ্য(বাইটকোড["ধ্রুবক"])
    };
};

// কম্পাইল_সোর্স - সোর্স কোড কম্পাইল করো (স্ট্রিং থেকে)
ধরি কম্পাইল_সোর্স = ফাংশন(সোর্স_কোড) {
    লেখ("=== ভাষা স্ব-হোস্টিং কম্পাইলার ===");
    লেখ("সোর্স কোড কম্পাইল করা হচ্ছে...");
    লেখ("");
    
    // লেক্সিক্যাল বিশ্লেষণ
    লেখ("১. লেক্সিক্যাল বিশ্লেষণ...");
    ধরি লেক্সার = নতুন_লেক্সার(সোর্স_কোড);
    
    // পার্সিং
    লেখ("২. সিনট্যাক্স বিশ্লেষণ...");
    ধরি পার্সার = নতুন_পার্সার(লেক্সার);
    ধরি পার্স_ফলাফল = পার্স_প্রোগ্রাম(পার্সার);
    
    পার্সার = পার্স_ফলাফল["পার্সার"];
    ধরি প্রোগ্রাম = পার্স_ফলাফল["প্রোগ্রাম"];
    
    যদি (দৈর্ঘ্য(পার্সার["ত্রুটি"]) > ০) {
        লেখ("❌ পার্সিং ত্রুটি:");
        পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(পার্সার["ত্রুটি"]); i = i + ১) {
            লেখ("  - " + পার্সার["ত্রুটি"][i]);
        }
        ফেরত {"সফল": মিথ্যা, "ত্রুটি": "পার্সিং ত্রুটি"};
    }
    
    // কম্পাইলেশন
    লেখ("৩. বাইটকোড কম্পাইলেশন...");
    ধরি কম্পাইলার = নতুন_কম্পাইলার();
    ধরি কম্পাইল_ফলাফল = কম্পাইল(কম্পাইলার, প্রোগ্রাম);
    
    যদি (!কম্পাইল_ফলাফল["সফল"]) {
        লেখ("❌ কম্পাইল ত্রুটি: " + কম্পাইল_ফলাফল["ত্রুটি"]);
        ফেরত {"সফল": মিথ্যা, "ত্রুটি": কম্পাইল_ফলাফল["ত্রুটি"]};
    }
    
    কম্পাইলার = কম্পাইল_ফলাফল["কম্পাইলার"];
    ধরি বাইটকোড = বাইটকোড_পাও(কম্পাইলার);
    
    লেখ("✅ কম্পাইলেশন সফল!");
    
    ফেরত {"সফল": সত্য, "বাইটকোড": বাইটকোড};
};

// =============== বাইটকোড আউটপুট ===============

// বাইটকোড_দেখাও - বাইটকোড বিস্তারিত দেখাও
ধরি বাইটকোড_দেখাও = ফাংশন(বাইটকোড) {
    লেখ("");
    লেখ("=== বাইটকোড বিস্তারিত ===");
    লেখ("");
    
    // নির্দেশ
    লেখ("নির্দেশ (" + লেখা(দৈর্ঘ্য(বাইটকোড["নির্দেশ"])) + " বাইট):");
    লেখ(নির্দেশ_থেকে_স্ট্রিং(বাইটকোড["নির্দেশ"]));
    
    // ধ্রুবক
    লেখ("");
    লেখ("ধ্রুবক (" + লেখা(দৈর্ঘ্য(বাইটকোড["ধ্রুবক"])) + " টি):");
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(বাইটকোড["ধ্রুবক"]); i = i + ১) {
        ধরি ধ্রুবক = বাইটকোড["ধ্রুবক"][i];
        লেখ("  [" + লেখা(i) + "] " + ধ্রুবক_থেকে_স্ট্রিং(ধ্রুবক));
    }
};

// ধ্রুবক_থেকে_স্ট্রিং - ধ্রুবক অবজেক্ট থেকে স্ট্রিং
ধরি ধ্রুবক_থেকে_স্ট্রিং = ফাংশন(ধ্রুবক) {
    যদি (ধ্রুবক == নাল) {
        ফেরত "নাল";
    }
    
    ধরি টাইপ = ধ্রুবক["টাইপ"];
    
    যদি (টাইপ == "INTEGER") {
        ফেরত "INTEGER: " + লেখা(ধ্রুবক["মান"]);
    } নাহলে যদি (টাইপ == "DOUBLE") {
        ফেরত "DOUBLE: " + লেখা(ধ্রুবক["মান"]);
    } নাহলে যদি (টাইপ == "STRING") {
        ফেরত "STRING: \"" + ধ্রুবক["মান"] + "\"";
    } নাহলে যদি (টাইপ == "COMPILED_FUNCTION") {
        ফেরত "FUNCTION (স্থানীয়: " + লেখা(ধ্রুবক["স্থানীয়_সংখ্যা"]) + 
               ", প্যারামিটার: " + লেখা(ধ্রুবক["প্যারামিটার_সংখ্যা"]) + ")";
    }
    
    ফেরত "অজানা টাইপ: " + টাইপ;
};

// =============== পরিসংখ্যান ===============

// কম্পাইল_পরিসংখ্যান - কম্পাইল পরিসংখ্যান দেখাও
ধরি কম্পাইল_পরিসংখ্যান = ফাংশন(ফলাফল) {
    লেখ("");
    লেখ("=== কম্পাইল পরিসংখ্যান ===");
    লেখ("টোকেন সংখ্যা: " + লেখা(ফলাফল["টোকেন_সংখ্যা"]));
    লেখ("বিবৃতি সংখ্যা: " + লেখা(ফলাফল["বিবৃতি_সংখ্যা"]));
    লেখ("নির্দেশ বাইট: " + লেখা(ফলাফল["নির্দেশ_সংখ্যা"]));
    লেখ("ধ্রুবক সংখ্যা: " + লেখা(ফলাফল["ধ্রুবক_সংখ্যা"]));
};

// =============== ব্যাচ কম্পাইলেশন ===============

// একাধিক_ফাইল_কম্পাইল - একাধিক ফাইল কম্পাইল করো
ধরি একাধিক_ফাইল_কম্পাইল = ফাংশন(ফাইল_পথ_তালিকা) {
    লেখ("=== একাধিক ফাইল কম্পাইলেশন ===");
    লেখ("মোট ফাইল: " + লেখা(দৈর্ঘ্য(ফাইল_পথ_তালিকা)));
    লেখ("");
    
    ধরি সফল_সংখ্যা = ০;
    ধরি ব্যর্থ_সংখ্যা = ০;
    
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(ফাইল_পথ_তালিকা); i = i + ১) {
        ধরি ফাইল_পথ = ফাইল_পথ_তালিকা[i];
        
        লেখ("[" + লেখা(i + ১) + "/" + লেখা(দৈর্ঘ্য(ফাইল_পথ_তালিকা)) + "] " + ফাইল_পথ);
        
        ধরি ফলাফল = কম্পাইল_ফাইল(ফাইল_পথ);
        
        যদি (ফলাফল["সফল"]) {
            সফল_সংখ্যা = সফল_সংখ্যা + ১;
        } নাহলে {
            ব্যর্থ_সংখ্যা = ব্যর্থ_সংখ্যা + ১;
        }
        
        লেখ("");
    }
    
    লেখ("=== সারসংক্ষেপ ===");
    লেখ("সফল: " + লেখা(সফল_সংখ্যা));
    লেখ("ব্যর্থ: " + লেখা(ব্যর্থ_সংখ্যা));
    
    ফেরত {
        "সফল_সংখ্যা": সফল_সংখ্যা,
        "ব্যর্থ_সংখ্যা": ব্যর্থ_সংখ্যা,
        "মোট": দৈর্ঘ্য(ফাইল_পথ_তালিকা)
    };
};

// =============== টেস্টিং সাপোর্ট ===============

// কম্পাইলার_পরীক্ষা - কম্পাইলার পরীক্ষা করো
ধরি কম্পাইলার_পরীক্ষা = ফাংশন() {
    লেখ("=== কম্পাইলার পরীক্ষা ===");
    লেখ("");
    
    // সাধারণ টেস্ট
    লেখ("পরীক্ষা ১: সাধারণ গাণিতিক অভিব্যক্তি");
    ধরি টেস্ট১ = "ধরি x = ৫ + ৩;";
    ধরি ফলাফল১ = কম্পাইল_সোর্স(টেস্ট১);
    যদি (ফলাফল১["সফল"]) {
        লেখ("✅ পাস");
    } নাহলে {
        লেখ("❌ ব্যর্থ");
    }
    
    লেখ("");
    লেখ("পরীক্ষা ২: ফাংশন সংজ্ঞা");
    ধরি টেস্ট২ = "ধরি যোগ = ফাংশন(a, b) { ফেরত a + b; };";
    ধরি ফলাফল২ = কম্পাইল_সোর্স(টেস্ট২);
    যদি (ফলাফল২["সফল"]) {
        লেখ("✅ পাস");
    } নাহলে {
        লেখ("❌ ব্যর্থ");
    }
    
    লেখ("");
    লেখ("পরীক্ষা ৩: যদি অভিব্যক্তি");
    ধরি টেস্ট৩ = "যদি (x > ৫) { লেখ(\"বড়\"); }";
    ধরি ফলাফল৩ = কম্পাইল_সোর্স(টেস্ট৩);
    যদি (ফলাফল৩["সফল"]) {
        লেখ("✅ পাস");
    } নাহলে {
        লেখ("❌ ব্যর্থ");
    }
    
    লেখ("");
    লেখ("সব পরীক্ষা সম্পন্ন!");
};

// =============== বুটস্ট্র্যাপ পরীক্ষা ===============

// বুটস্ট্র্যাপ_পরীক্ষা - স্ব-হোস্টিং বুটস্ট্র্যাপ পরীক্ষা
ধরি বুটস্ট্র্যাপ_পরীক্ষা = ফাংশন() {
    লেখ("=== বুটস্ট্র্যাপ পরীক্ষা ===");
    লেখ("স্ব-হোস্টিং কম্পাইলার নিজেকে কম্পাইল করতে পারে কি না পরীক্ষা করা হচ্ছে...");
    লেখ("");
    
    // কম্পাইলার মডিউল কম্পাইল করার চেষ্টা করো
    ধরি মডিউল_তালিকা = [
        "modules/টোকেন.ভাষা",
        "modules/লেক্সার.ভাষা",
        "modules/এএসটি.ভাষা",
        "modules/পার্সার.ভাষা",
        "modules/প্রতীক_টেবিল.ভাষা",
        "modules/কোড.ভাষা",
        "modules/কম্পাইলার.ভাষা"
    ];
    
    লেখ("কম্পাইলার মডিউল পরীক্ষা করা হচ্ছে:");
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(মডিউল_তালিকা); i = i + ১) {
        লেখ("  " + লেখা(i + ১) + ". " + মডিউল_তালিকা[i]);
    }
    
    লেখ("");
    লেখ("✅ বুটস্ট্র্যাপ পরীক্ষা প্রস্তুত!");
    লেখ("নোট: বাস্তব বুটস্ট্র্যাপের জন্য Go VM দ্বারা চালনা প্রয়োজন");
};

// =============== সংস্করণ তথ্য ===============

// সংস্করণ_দেখাও - কম্পাইলার সংস্করণ দেখাও
ধরি সংস্করণ_দেখাও = ফাংশন() {
    লেখ("ভাষা স্ব-হোস্টিং কম্পাইলার");
    লেখ("সংস্করণ: ১.০.০");
    লেখ("বিবরণ: সম্পূর্ণ বাংলা ভাষায় লেখা স্ব-হোস্টিং কম্পাইলার");
    লেখ("");
    লেখ("বৈশিষ্ট্য:");
    লেখ("  ✓ লেক্সিক্যাল বিশ্লেষণ (Lexer)");
    লেখ("  ✓ সিনট্যাক্স বিশ্লেষণ (Parser)");
    লেখ("  ✓ AST নির্মাণ");
    লেখ("  ✓ বাইটকোড কম্পাইলেশন");
    লেখ("  ✓ স্কোপ ম্যানেজমেন্ট");
    লেখ("  ✓ মডিউল সিস্টেম");
    লেখ("  ✓ সম্পূর্ণ বাংলা সিনট্যাক্স");
};

// =============== মূল এন্ট্রি পয়েন্ট ===============

// মূল - কম্পাইলারের মূল এন্ট্রি পয়েন্ট
ধরি মূল = ফাংশন(আর্গুমেন্ট) {
    সংস্করণ_দেখাও();
    লেখ("");
    
    // যদি কোন ফাইল দেওয়া না থাকে, টেস্ট চালাও
    যদি (দৈর্ঘ্য(আর্গুমেন্ট) == ০) {
        কম্পাইলার_পরীক্ষা();
        ফেরত ০;
    }
    
    // প্রথম আর্গুমেন্ট হল ফাইল পথ
    ধরি ফাইল_পথ = আর্গুমেন্ট[০];
    ধরি ফলাফল = কম্পাইল_ফাইল(ফাইল_পথ);
    
    যদি (ফলাফল["সফল"]) {
        কম্পাইল_পরিসংখ্যান(ফলাফল);
        বাইটকোড_দেখাও(ফলাফল["বাইটকোড"]);
        ফেরত ০;
    } নাহলে {
        ফেরত ১;
    }
};

লেখ("ভাষা কম্পাইলার মডিউল লোড হয়েছে");

// স্ব-পরীক্ষা
// কম্পাইলার_পরীক্ষা();

