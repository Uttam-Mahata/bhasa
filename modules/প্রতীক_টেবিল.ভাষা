// প্রতীক টেবিল মডিউল - Symbol Table (চলক স্কোপিং এর জন্য)
// চলকের স্কোপ এবং সূচক ট্র্যাক করে

// প্রতীক স্কোপ ধরন
ধরি বৈশ্বিক_স্কোপ = "বৈশ্বিক";
ধরি স্থানীয়_স্কোপ = "স্থানীয়";
ধরি বিল্টইন_স্কোপ = "বিল্টইন";
ধরি মুক্ত_স্কোপ = "মুক্ত";
ধরি ফাংশন_স্কোপ = "ফাংশন";

// নতুন_প্রতীক - নতুন প্রতীক তৈরি করো
ধরি নতুন_প্রতীক = ফাংশন(নাম, স্কোপ, সূচক) {
    ফেরত {
        "নাম": নাম,
        "স্কোপ": স্কোপ,
        "সূচক": সূচক
    };
};

// নতুন_প্রতীক_টেবিল - নতুন প্রতীক টেবিল তৈরি করো
ধরি নতুন_প্রতীক_টেবিল = ফাংশন() {
    ফেরত {
        "বাইরের": নাল,
        "ভাণ্ডার": {},
        "সংজ্ঞা_সংখ্যা": ০,
        "মুক্ত_প্রতীক": []
    };
};

// নতুন_আবদ্ধ_প্রতীক_টেবিল - বাইরের টেবিল দিয়ে নতুন টেবিল তৈরি করো
ধরি নতুন_আবদ্ধ_প্রতীক_টেবিল = ফাংশন(বাইরের_টেবিল) {
    ধরি টেবিল = নতুন_প্রতীক_টেবিল();
    টেবিল["বাইরের"] = বাইরের_টেবিল;
    ফেরত টেবিল;
};

// প্রতীক_সংজ্ঞা - প্রতীক সংজ্ঞায়িত করো
ধরি প্রতীক_সংজ্ঞা = ফাংশন(টেবিল, নাম) {
    ধরি সূচক = টেবিল["সংজ্ঞা_সংখ্যা"];
    ধরি স্কোপ;
    
    // বাইরের টেবিল না থাকলে বৈশ্বিক স্কোপ
    যদি (টেবিল["বাইরের"] == নাল) {
        স্কোপ = বৈশ্বিক_স্কোপ;
    } নাহলে {
        স্কোপ = স্থানীয়_স্কোপ;
    }
    
    ধরি প্রতীক = নতুন_প্রতীক(নাম, স্কোপ, সূচক);
    টেবিল["ভাণ্ডার"][নাম] = প্রতীক;
    টেবিল["সংজ্ঞা_সংখ্যা"] = টেবিল["সংজ্ঞা_সংখ্যা"] + ১;
    
    ফেরত {"টেবিল": টেবিল, "প্রতীক": প্রতীক};
};

// বিল্টইন_সংজ্ঞা - বিল্টইন ফাংশন সংজ্ঞায়িত করো
ধরি বিল্টইন_সংজ্ঞা = ফাংশন(টেবিল, সূচক, নাম) {
    ধরি প্রতীক = নতুন_প্রতীক(নাম, বিল্টইন_স্কোপ, সূচক);
    টেবিল["ভাণ্ডার"][নাম] = প্রতীক;
    
    ফেরত {"টেবিল": টেবিল, "প্রতীক": প্রতীক};
};

// ফাংশন_নাম_সংজ্ঞা - রিকার্শনের জন্য ফাংশন নাম সংজ্ঞায়িত করো
ধরি ফাংশন_নাম_সংজ্ঞা = ফাংশন(টেবিল, নাম) {
    ধরি প্রতীক = নতুন_প্রতীক(নাম, ফাংশন_স্কোপ, ০);
    টেবিল["ভাণ্ডার"][নাম] = প্রতীক;
    
    ফেরত {"টেবিল": টেবিল, "প্রতীক": প্রতীক};
};

// প্রতীক_খোঁজো - নাম দিয়ে প্রতীক খোঁজো
ধরি প্রতীক_খোঁজো = ফাংশন(টেবিল, নাম) {
    // বর্তমান টেবিলে খোঁজো
    যদি (চাবি_আছে(টেবিল["ভাণ্ডার"], নাম)) {
        ফেরত {
            "পাওয়া_গেছে": সত্য,
            "প্রতীক": টেবিল["ভাণ্ডার"][নাম],
            "টেবিল": টেবিল
        };
    }
    
    // বাইরের টেবিলে খোঁজো
    যদি (টেবিল["বাইরের"] != নাল) {
        ধরি ফলাফল = প্রতীক_খোঁজো(টেবিল["বাইরের"], নাম);
        
        যদি (!ফলাফল["পাওয়া_গেছে"]) {
            ফেরত ফলাফল;
        }
        
        ধরি প্রতীক = ফলাফল["প্রতীক"];
        
        // বৈশ্বিক বা বিল্টইন স্কোপ হলে সরাসরি ফেরত দাও
        যদি (প্রতীক["স্কোপ"] == বৈশ্বিক_স্কোপ || প্রতীক["স্কোপ"] == বিল্টইন_স্কোপ) {
            ফেরত ফলাফল;
        }
        
        // মুক্ত চলক হিসাবে সংজ্ঞায়িত করো (closure এর জন্য)
        ধরি মুক্ত_ফলাফল = মুক্ত_প্রতীক_সংজ্ঞা(টেবিল, প্রতীক);
        ফেরত {
            "পাওয়া_গেছে": সত্য,
            "প্রতীক": মুক্ত_ফলাফল["প্রতীক"],
            "টেবিল": মুক্ত_ফলাফল["টেবিল"]
        };
    }
    
    // পাওয়া যায়নি
    ফেরত {"পাওয়া_গেছে": মিথ্যা, "প্রতীক": নাল, "টেবিল": টেবিল};
};

// মুক্ত_প্রতীক_সংজ্ঞা - মুক্ত প্রতীক সংজ্ঞায়িত করো (closure এর জন্য)
ধরি মুক্ত_প্রতীক_সংজ্ঞা = ফাংশন(টেবিল, মূল_প্রতীক) {
    // মুক্ত প্রতীক তালিকায় যোগ করো
    টেবিল["মুক্ত_প্রতীক"] = যোগ(টেবিল["মুক্ত_প্রতীক"], মূল_প্রতীক);
    
    ধরি সূচক = দৈর্ঘ্য(টেবিল["মুক্ত_প্রতীক"]) - ১;
    ধরি প্রতীক = নতুন_প্রতীক(মূল_প্রতীক["নাম"], মুক্ত_স্কোপ, সূচক);
    
    টেবিল["ভাণ্ডার"][মূল_প্রতীক["নাম"]] = প্রতীক;
    
    ফেরত {"টেবিল": টেবিল, "প্রতীক": প্রতীক};
};

// প্রতীক_সংখ্যা - সংজ্ঞায়িত প্রতীক সংখ্যা পাও
ধরি প্রতীক_সংখ্যা = ফাংশন(টেবিল) {
    ফেরত টেবিল["সংজ্ঞা_সংখ্যা"];
};

// মুক্ত_প্রতীক_সংখ্যা - মুক্ত প্রতীক সংখ্যা পাও
ধরি মুক্ত_প্রতীক_সংখ্যা = ফাংশন(টেবিল) {
    ফেরত দৈর্ঘ্য(টেবিল["মুক্ত_প্রতীক"]);
};

// বাইরের_টেবিল_আছে - বাইরের টেবিল আছে কি না পরীক্ষা করো
ধরি বাইরের_টেবিল_আছে = ফাংশন(টেবিল) {
    ফেরত টেবিল["বাইরের"] != নাল;
};

// বাইরের_টেবিল_পাও - বাইরের টেবিল পাও
ধরি বাইরের_টেবিল_পাও = ফাংশন(টেবিল) {
    ফেরত টেবিল["বাইরের"];
};

// প্রতীক_থেকে_স্ট্রিং - প্রতীককে স্ট্রিং-এ রূপান্তর করো (ডিবাগিংয়ের জন্য)
ধরি প্রতীক_থেকে_স্ট্রিং = ফাংশন(প্রতীক) {
    যদি (প্রতীক == নাল) {
        ফেরত "প্রতীক: নাল";
    }
    
    ধরি ফলাফল = "প্রতীক{নাম: " + প্রতীক["নাম"] + ", স্কোপ: " + প্রতীক["স্কোপ"] + ", সূচক: " + লেখা(প্রতীক["সূচক"]) + "}";
    ফেরত ফলাফল;
};

// টেবিল_থেকে_স্ট্রিং - প্রতীক টেবিলকে স্ট্রিং-এ রূপান্তর করো (ডিবাগিংয়ের জন্য)
ধরি টেবিল_থেকে_স্ট্রিং = ফাংশন(টেবিল) {
    যদি (টেবিল == নাল) {
        ফেরত "টেবিল: নাল";
    }
    
    ধরি ফলাফল = "প্রতীক_টেবিল{সংজ্ঞা: " + লেখা(টেবিল["সংজ্ঞা_সংখ্যা"]);
    ফলাফল = ফলাফল + ", মুক্ত: " + লেখা(দৈর্ঘ্য(টেবিল["মুক্ত_প্রতীক"]));
    
    যদি (টেবিল["বাইরের"] != নাল) {
        ফলাফল = ফলাফল + ", বাইরের: হ্যাঁ";
    } নাহলে {
        ফলাফল = ফলাফল + ", বাইরের: না";
    }
    
    ফলাফল = ফলাফল + "}";
    ফেরত ফলাফল;
};

// বিল্টইন_ফাংশন_তালিকা - সব বিল্টইন ফাংশন নিবন্ধন করো
ধরি বিল্টইন_ফাংশন_নিবন্ধন = ফাংশন(টেবিল) {
    ধরি বিল্টইন_নাম = [
        "দৈর্ঘ্য", "প্রথম", "শেষ", "বাকি", "যোগ", "লেখ", 
        "কোড", "চাবি_আছে", "সংখ্যা", "লেখা",
        "বাইট", "ছোট_সংখ্যা", "পূর্ণসংখ্যা", "দীর্ঘ_সংখ্যা",
        "দশমিক", "দশমিক_দ্বিগুণ", "অক্ষর_রূপান্তর"
    ];
    
    ধরি সূচক = ০;
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(বিল্টইন_নাম); i = i + ১) {
        ধরি ফলাফল = বিল্টইন_সংজ্ঞা(টেবিল, সূচক, বিল্টইন_নাম[i]);
        টেবিল = ফলাফল["টেবিল"];
        সূচক = সূচক + ১;
    }
    
    ফেরত টেবিল;
};

লেখ("প্রতীক টেবিল মডিউল লোড হয়েছে");

