// কম্পাইলার মডিউল - AST থেকে বাইটকোড কম্পাইলার
// স্কোপ ম্যানেজমেন্ট এবং সম্পূর্ণ কম্পাইলেশন লজিক

অন্তর্ভুক্ত "modules/এএসটি";
অন্তর্ভুক্ত "modules/কোড";
অন্তর্ভুক্ত "modules/প্রতীক_টেবিল";

// =============== কম্পাইলার কাঠামো ===============

// নতুন_কম্পাইলার - নতুন কম্পাইলার তৈরি করো
ধরি নতুন_কম্পাইলার = ফাংশন() {
    ধরি মূল_স্কোপ = {
        "নির্দেশ": [],
        "শেষ_নির্দেশ": {"অপকোড": -১, "অবস্থান": ০},
        "আগের_নির্দেশ": {"অপকোড": -১, "অবস্থান": ০}
    };
    
    ধরি প্রতীক_টেবিল = নতুন_প্রতীক_টেবিল();
    প্রতীক_টেবিল = বিল্টইন_ফাংশন_নিবন্ধন(প্রতীক_টেবিল);
    
    ফেরত {
        "ধ্রুবক": [],
        "প্রতীক_টেবিল": প্রতীক_টেবিল,
        "স্কোপ_তালিকা": [মূল_স্কোপ],
        "স্কোপ_সূচক": ০,
        "লুপ_স্ট্যাক": []
    };
};

// =============== ধ্রুবক ম্যানেজমেন্ট ===============

// ধ্রুবক_যোগ - ধ্রুবক তালিকায় যোগ করো
ধরি ধ্রুবক_যোগ = ফাংশন(কম্পাইলার, বস্তু) {
    কম্পাইলার["ধ্রুবক"] = যোগ(কম্পাইলার["ধ্রুবক"], বস্তু);
    ফেরত দৈর্ঘ্য(কম্পাইলার["ধ্রুবক"]) - ১;
};

// =============== নির্দেশ নির্গমন (Emit) ===============

// নির্দেশ_নির্গমন - বাইটকোড নির্দেশ নির্গমন করো
ধরি নির্দেশ_নির্গমন = ফাংশন(কম্পাইলার, অপ, অপারেন্ড) {
    ধরি নির্দেশ = নির্দেশ_তৈরি(অপ, অপারেন্ড);
    ধরি অবস্থান = নির্দেশ_সংযোজন(কম্পাইলার, নির্দেশ);
    শেষ_নির্দেশ_সেট(কম্পাইলার, অপ, অবস্থান);
    ফেরত অবস্থান;
};

// নির্দেশ_সংযোজন - বর্তমান স্কোপে নির্দেশ সংযোজন করো
ধরি নির্দেশ_সংযোজন = ফাংশন(কম্পাইলার, নির্দেশ) {
    ধরি বর্তমান_স্কোপ = কম্পাইলার["স্কোপ_তালিকা"][কম্পাইলার["স্কোপ_সূচক"]];
    ধরি অবস্থান = দৈর্ঘ্য(বর্তমান_স্কোপ["নির্দেশ"]);
    
    বর্তমান_স্কোপ["নির্দেশ"] = নির্দেশ_জোড়া_লাগাও(বর্তমান_স্কোপ["নির্দেশ"], নির্দেশ);
    
    ফেরত অবস্থান;
};

// শেষ_নির্দেশ_সেট - শেষ নির্দেশ ট্র্যাক করো
ধরি শেষ_নির্দেশ_সেট = ফাংশন(কম্পাইলার, অপ, অবস্থান) {
    ধরি বর্তমান_স্কোপ = কম্পাইলার["স্কোপ_তালিকা"][কম্পাইলার["স্কোপ_সূচক"]];
    
    বর্তমান_স্কোপ["আগের_নির্দেশ"] = বর্তমান_স্কোপ["শেষ_নির্দেশ"];
    বর্তমান_স্কোপ["শেষ_নির্দেশ"] = {"অপকোড": অপ, "অবস্থান": অবস্থান};
};

// শেষ_নির্দেশ_কি - শেষ নির্দেশ পরীক্ষা করো
ধরি শেষ_নির্দেশ_কি = ফাংশন(কম্পাইলার, অপ) {
    ধরি বর্তমান_স্কোপ = কম্পাইলার["স্কোপ_তালিকা"][কম্পাইলার["স্কোপ_সূচক"]];
    ফেরত বর্তমান_স্কোপ["শেষ_নির্দেশ"]["অপকোড"] == অপ;
};

// শেষ_পপ_সরাও - শেষ পপ নির্দেশ সরাও (অপ্টিমাইজেশন)
ধরি শেষ_পপ_সরাও = ফাংশন(কম্পাইলার) {
    ধরি বর্তমান_স্কোপ = কম্পাইলার["স্কোপ_তালিকা"][কম্পাইলার["স্কোপ_সূচক"]];
    ধরি শেষ = বর্তমান_স্কোপ["শেষ_নির্দেশ"]["অবস্থান"];
    
    বর্তমান_স্কোপ["নির্দেশ"] = অ্যারে_স্লাইস(বর্তমান_স্কোপ["নির্দেশ"], ০, শেষ);
    বর্তমান_স্কোপ["শেষ_নির্দেশ"] = বর্তমান_স্কোপ["আগের_নির্দেশ"];
};

// নির্দেশ_প্রতিস্থাপন - নির্দিষ্ট অবস্থানে নির্দেশ প্রতিস্থাপন করো
ধরি নির্দেশ_প্রতিস্থাপন = ফাংশন(কম্পাইলার, অবস্থান, নতুন_নির্দেশ) {
    ধরি বর্তমান_স্কোপ = কম্পাইলার["স্কোপ_তালিকা"][কম্পাইলার["স্কোপ_সূচক"]];
    
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(নতুন_নির্দেশ); i = i + ১) {
        বর্তমান_স্কোপ["নির্দেশ"][অবস্থান + i] = নতুন_নির্দেশ[i];
    }
};

// অপারেন্ড_পরিবর্তন - অপারেন্ড পরিবর্তন করো
ধরি অপারেন্ড_পরিবর্তন = ফাংশন(কম্পাইলার, অবস্থান, অপারেন্ড) {
    ধরি বর্তমান_স্কোপ = কম্পাইলার["স্কোপ_তালিকা"][কম্পাইলার["স্কোপ_সূচক"]];
    ধরি অপ = বর্তমান_স্কোপ["নির্দেশ"][অবস্থান];
    ধরি নতুন_নির্দেশ = নির্দেশ_তৈরি(অপ, অপারেন্ড);
    নির্দেশ_প্রতিস্থাপন(কম্পাইলার, অবস্থান, নতুন_নির্দেশ);
};

// বর্তমান_নির্দেশ_পাও - বর্তমান স্কোপের নির্দেশ পাও
ধরি বর্তমান_নির্দেশ_পাও = ফাংশন(কম্পাইলার) {
    ধরি বর্তমান_স্কোপ = কম্পাইলার["স্কোপ_তালিকা"][কম্পাইলার["স্কোপ_সূচক"]];
    ফেরত বর্তমান_স্কোপ["নির্দেশ"];
};

// =============== স্কোপ ম্যানেজমেন্ট ===============

// স্কোপ_প্রবেশ - নতুন স্কোপে প্রবেশ করো
ধরি স্কোপ_প্রবেশ = ফাংশন(কম্পাইলার) {
    ধরি স্কোপ = {
        "নির্দেশ": [],
        "শেষ_নির্দেশ": {"অপকোড": -১, "অবস্থান": ০},
        "আগের_নির্দেশ": {"অপকোড": -১, "অবস্থান": ০}
    };
    
    কম্পাইলার["স্কোপ_তালিকা"] = যোগ(কম্পাইলার["স্কোপ_তালিকা"], স্কোপ);
    কম্পাইলার["স্কোপ_সূচক"] = কম্পাইলার["স্কোপ_সূচক"] + ১;
    
    // নতুন প্রতীক টেবিল তৈরি করো
    কম্পাইলার["প্রতীক_টেবিল"] = নতুন_আবদ্ধ_প্রতীক_টেবিল(কম্পাইলার["প্রতীক_টেবিল"]);
    
    ফেরত কম্পাইলার;
};

// স্কোপ_প্রস্থান - বর্তমান স্কোপ থেকে বের হও
ধরি স্কোপ_প্রস্থান = ফাংশন(কম্পাইলার) {
    ধরি নির্দেশ = বর্তমান_নির্দেশ_পাও(কম্পাইলার);
    
    // বাইরের স্কোপে ফিরে যাও
    কম্পাইলার["স্কোপ_সূচক"] = কম্পাইলার["স্কোপ_সূচক"] - ১;
    কম্পাইলার["স্কোপ_তালিকা"] = অ্যারে_স্লাইস(কম্পাইলার["স্কোপ_তালিকা"], ০, দৈর্ঘ্য(কম্পাইলার["স্কোপ_তালিকা"]) - ১);
    
    // বাইরের প্রতীক টেবিল পুনরুদ্ধার করো
    কম্পাইলার["প্রতীক_টেবিল"] = বাইরের_টেবিল_পাও(কম্পাইলার["প্রতীক_টেবিল"]);
    
    ফেরত {"কম্পাইলার": কম্পাইলার, "নির্দেশ": নির্দেশ};
};

// =============== লুপ ম্যানেজমেন্ট (break/continue এর জন্য) ===============

// লুপ_শুরু - নতুন লুপ শুরু করো
ধরি লুপ_শুরু = ফাংশন(কম্পাইলার, শুরু_অবস্থান) {
    ধরি লুপ_প্রসঙ্গ = {
        "লুপ_শুরু": শুরু_অবস্থান,
        "বিরতি_অবস্থান": [],
        "চালিয়ে_অবস্থান": []
    };
    কম্পাইলার["লুপ_স্ট্যাক"] = যোগ(কম্পাইলার["লুপ_স্ট্যাক"], লুপ_প্রসঙ্গ);
    ফেরত কম্পাইলার;
};

// লুপ_শেষ - লুপ শেষ করো এবং break/continue প্যাচ করো
ধরি লুপ_শেষ = ফাংশন(কম্পাইলার, শেষ_অবস্থান) {
    যদি (দৈর্ঘ্য(কম্পাইলার["লুপ_স্ট্যাক"]) == ০) {
        ফেরত কম্পাইলার;
    }
    
    ধরি লুপ_প্রসঙ্গ = কম্পাইলার["লুপ_স্ট্যাক"][দৈর্ঘ্য(কম্পাইলার["লুপ_স্ট্যাক"]) - ১];
    
    // সব break অবস্থান প্যাচ করো
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(লুপ_প্রসঙ্গ["বিরতি_অবস্থান"]); i = i + ১) {
        অপারেন্ড_পরিবর্তন(কম্পাইলার, লুপ_প্রসঙ্গ["বিরতি_অবস্থান"][i], [শেষ_অবস্থান]);
    }
    
    // সব continue অবস্থান প্যাচ করো
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(লুপ_প্রসঙ্গ["চালিয়ে_অবস্থান"]); i = i + ১) {
        অপারেন্ড_পরিবর্তন(কম্পাইলার, লুপ_প্রসঙ্গ["চালিয়ে_অবস্থান"][i], [লুপ_প্রসঙ্গ["লুপ_শুরু"]]);
    }
    
    // লুপ স্ট্যাক থেকে সরাও
    কম্পাইলার["লুপ_স্ট্যাক"] = অ্যারে_স্লাইস(কম্পাইলার["লুপ_স্ট্যাক"], ০, দৈর্ঘ্য(কম্পাইলার["লুপ_স্ট্যাক"]) - ১);
    
    ফেরত কম্পাইলার;
};

// বিরতি_যোগ - break অবস্থান যোগ করো
ধরি বিরতি_যোগ = ফাংশন(কম্পাইলার, অবস্থান) {
    যদি (দৈর্ঘ্য(কম্পাইলার["লুপ_স্ট্যাক"]) == ০) {
        ফেরত কম্পাইলার;
    }
    
    ধরি লুপ_প্রসঙ্গ = কম্পাইলার["লুপ_স্ট্যাক"][দৈর্ঘ্য(কম্পাইলার["লুপ_স্ট্যাক"]) - ১];
    লুপ_প্রসঙ্গ["বিরতি_অবস্থান"] = যোগ(লুপ_প্রসঙ্গ["বিরতি_অবস্থান"], অবস্থান);
    
    ফেরত কম্পাইলার;
};

// চালিয়ে_যোগ - continue অবস্থান যোগ করো
ধরি চালিয়ে_যোগ = ফাংশন(কম্পাইলার, অবস্থান) {
    যদি (দৈর্ঘ্য(কম্পাইলার["লুপ_স্ট্যাক"]) == ০) {
        ফেরত কম্পাইলার;
    }
    
    ধরি লুপ_প্রসঙ্গ = কম্পাইলার["লুপ_স্ট্যাক"][দৈর্ঘ্য(কম্পাইলার["লুপ_স্ট্যাক"]) - ১];
    লুপ_প্রসঙ্গ["চালিয়ে_অবস্থান"] = যোগ(লুপ_প্রসঙ্গ["চালিয়ে_অবস্থান"], অবস্থান);
    
    ফেরত কম্পাইলার;
};

// =============== মূল কম্পাইলেশন ফাংশন ===============

// কম্পাইল - AST নোড কম্পাইল করো
ধরি কম্পাইল = ফাংশন(কম্পাইলার, নোড) {
    যদি (নোড == নাল) {
        ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
    }
    
    ধরি নোড_টাইপ = নোড["নোড_টাইপ"];
    
    যদি (নোড_টাইপ == বিবৃতি_নোড) {
        ফেরত কম্পাইল_বিবৃতি(কম্পাইলার, নোড);
    } নাহলে যদি (নোড_টাইপ == অভিব্যক্তি_নোড) {
        ফেরত কম্পাইল_অভিব্যক্তি(কম্পাইলার, নোড);
    } নাহলে যদি (নোড["টাইপ"] == "প্রোগ্রাম") {
        ফেরত কম্পাইল_প্রোগ্রাম(কম্পাইলার, নোড);
    }
    
    ফেরত {"সফল": মিথ্যা, "কম্পাইলার": কম্পাইলার, "ত্রুটি": "অজানা নোড টাইপ"};
};

// কম্পাইল_প্রোগ্রাম - প্রোগ্রাম কম্পাইল করো
ধরি কম্পাইল_প্রোগ্রাম = ফাংশন(কম্পাইলার, প্রোগ্রাম) {
    ধরি বিবৃতি_তালিকা = প্রোগ্রাম["বিবৃতি"];
    
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(বিবৃতি_তালিকা); i = i + ১) {
        ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি_তালিকা[i]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
    }
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_বিবৃতি - বিবৃতি কম্পাইল করো
ধরি কম্পাইল_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    ধরি বিবৃতি_টাইপ = বিবৃতি["বিবৃতি_টাইপ"];
    
    যদি (বিবৃতি_টাইপ == ধরি_বিবৃতি_টাইপ) {
        ফেরত কম্পাইল_ধরি_বিবৃতি(কম্পাইলার, বিবৃতি);
    } নাহলে যদি (বিবৃতি_টাইপ == ফেরত_বিবৃতি_টাইপ) {
        ফেরত কম্পাইল_ফেরত_বিবৃতি(কম্পাইলার, বিবৃতি);
    } নাহলে যদি (বিবৃতি_টাইপ == অভিব্যক্তি_বিবৃতি_টাইপ) {
        ফেরত কম্পাইল_অভিব্যক্তি_বিবৃতি(কম্পাইলার, বিবৃতি);
    } নাহলে যদি (বিবৃতি_টাইপ == ব্লক_বিবৃতি_টাইপ) {
        ফেরত কম্পাইল_ব্লক_বিবৃতি(কম্পাইলার, বিবৃতি);
    } নাহলে যদি (বিবৃতি_টাইপ == যতক্ষণ_বিবৃতি_টাইপ) {
        ফেরত কম্পাইল_যতক্ষণ_বিবৃতি(কম্পাইলার, বিবৃতি);
    } নাহলে যদি (বিবৃতি_টাইপ == পর্যন্ত_বিবৃতি_টাইপ) {
        ফেরত কম্পাইল_পর্যন্ত_বিবৃতি(কম্পাইলার, বিবৃতি);
    } নাহলে যদি (বিবৃতি_টাইপ == বিরতি_বিবৃতি_টাইপ) {
        ফেরত কম্পাইল_বিরতি_বিবৃতি(কম্পাইলার, বিবৃতি);
    } নাহলে যদি (বিবৃতি_টাইপ == চালিয়ে_যাও_বিবৃতি_টাইপ) {
        ফেরত কম্পাইল_চালিয়ে_যাও_বিবৃতি(কম্পাইলার, বিবৃতি);
    } নাহলে যদি (বিবৃতি_টাইপ == নির্ধারণ_বিবৃতি_টাইপ) {
        ফেরত কম্পাইল_নির্ধারণ_বিবৃতি(কম্পাইলার, বিবৃতি);
    }
    
    ফেরত {"সফল": মিথ্যা, "কম্পাইলার": কম্পাইলার, "ত্রুটি": "অজানা বিবৃতি টাইপ"};
};

// কম্পাইল_অভিব্যক্তি - অভিব্যক্তি কম্পাইল করো
ধরি কম্পাইল_অভিব্যক্তি = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    ধরি অভিব্যক্তি_টাইপ = অভিব্যক্তি["অভিব্যক্তি_টাইপ"];
    
    যদি (অভিব্যক্তি_টাইপ == পূর্ণসংখ্যা_লিটারেল_টাইপ) {
        ফেরত কম্পাইল_পূর্ণসংখ্যা_লিটারেল(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == দশমিক_লিটারেল_টাইপ) {
        ফেরত কম্পাইল_দশমিক_লিটারেল(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == স্ট্রিং_লিটারেল_টাইপ) {
        ফেরত কম্পাইল_স্ট্রিং_লিটারেল(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == বুলিয়ান_টাইপ) {
        ফেরত কম্পাইল_বুলিয়ান(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == শনাক্তকারী_টাইপ) {
        ফেরত কম্পাইল_শনাক্তকারী(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == উপসর্গ_অভিব্যক্তি_টাইপ) {
        ফেরত কম্পাইল_উপসর্গ_অভিব্যক্তি(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == মধ্যবর্তী_অভিব্যক্তি_টাইপ) {
        ফেরত কম্পাইল_মধ্যবর্তী_অভিব্যক্তি(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == যদি_অভিব্যক্তি_টাইপ) {
        ফেরত কম্পাইল_যদি_অভিব্যক্তি(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == ফাংশন_লিটারেল_টাইপ) {
        ফেরত কম্পাইল_ফাংশন_লিটারেল(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == কল_অভিব্যক্তি_টাইপ) {
        ফেরত কম্পাইল_কল_অভিব্যক্তি(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == অ্যারে_লিটারেল_টাইপ) {
        ফেরত কম্পাইল_অ্যারে_লিটারেল(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == হ্যাশ_লিটারেল_টাইপ) {
        ফেরত কম্পাইল_হ্যাশ_লিটারেল(কম্পাইলার, অভিব্যক্তি);
    } নাহলে যদি (অভিব্যক্তি_টাইপ == সূচক_অভিব্যক্তি_টাইপ) {
        ফেরত কম্পাইল_সূচক_অভিব্যক্তি(কম্পাইলার, অভিব্যক্তি);
    }
    
    ফেরত {"সফল": মিথ্যা, "কম্পাইলার": কম্পাইলার, "ত্রুটি": "অজানা অভিব্যক্তি টাইপ"};
};

// =============== বিবৃতি কম্পাইলেশন ===============

// কম্পাইল_ধরি_বিবৃতি - ধরি বিবৃতি কম্পাইল করো
ধরি কম্পাইল_ধরি_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    // মান কম্পাইল করো
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["মান"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // প্রতীক সংজ্ঞায়িত করো
    ধরি নাম = বিবৃতি["নাম"]["মান"];
    ধরি প্রতীক_ফলাফল = প্রতীক_সংজ্ঞা(কম্পাইলার["প্রতীক_টেবিল"], নাম);
    কম্পাইলার["প্রতীক_টেবিল"] = প্রতীক_ফলাফল["টেবিল"];
    
    ধরি প্রতীক = প্রতীক_ফলাফল["প্রতীক"];
    
    // সঠিক নির্দেশ নির্গমন করো
    যদি (প্রতীক["স্কোপ"] == বৈশ্বিক_স্কোপ) {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বৈশ্বিক_সেট, [প্রতীক["সূচক"]]);
    } নাহলে {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_স্থানীয়_সেট, [প্রতীক["সূচক"]]);
    }
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_ফেরত_বিবৃতি - ফেরত বিবৃতি কম্পাইল করো
ধরি কম্পাইল_ফেরত_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["ফেরত_মান"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_মান_ফেরত, []);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_অভিব্যক্তি_বিবৃতি - অভিব্যক্তি বিবৃতি কম্পাইল করো
ধরি কম্পাইল_অভিব্যক্তি_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["অভিব্যক্তি"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_পপ, []);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_ব্লক_বিবৃতি - ব্লক বিবৃতি কম্পাইল করো
ধরি কম্পাইল_ব্লক_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    ধরি বিবৃতি_তালিকা = বিবৃতি["বিবৃতি"];
    
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(বিবৃতি_তালিকা); i = i + ১) {
        ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি_তালিকা[i]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
    }
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_যতক্ষণ_বিবৃতি - যতক্ষণ লুপ কম্পাইল করো
ধরি কম্পাইল_যতক্ষণ_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    ধরি লুপ_শুরু_অবস্থান = দৈর্ঘ্য(বর্তমান_নির্দেশ_পাও(কম্পাইলার));
    
    // লুপ শুরু করো
    কম্পাইলার = লুপ_শুরু(কম্পাইলার, লুপ_শুরু_অবস্থান);
    
    // শর্ত কম্পাইল করো
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["শর্ত"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // লাফ নির্দেশ (মিথ্যা হলে লুপ থেকে বের হও)
    ধরি লাফ_অবস্থান = নির্দেশ_নির্গমন(কম্পাইলার, অপ_লাফ_মিথ্যা, [৯৯৯৯]);
    
    // দেহ কম্পাইল করো
    ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["দেহ"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // লুপ শুরুতে ফিরে যাও
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_লাফ, [লুপ_শুরু_অবস্থান]);
    
    // লুপ শেষ অবস্থান
    ধরি লুপ_শেষ_অবস্থান = দৈর্ঘ্য(বর্তমান_নির্দেশ_পাও(কম্পাইলার));
    
    // লাফ অপারেন্ড প্যাচ করো
    অপারেন্ড_পরিবর্তন(কম্পাইলার, লাফ_অবস্থান, [লুপ_শেষ_অবস্থান]);
    
    // লুপ শেষ করো
    কম্পাইলার = লুপ_শেষ(কম্পাইলার, লুপ_শেষ_অবস্থান);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_পর্যন্ত_বিবৃতি - পর্যন্ত (for) লুপ কম্পাইল করো
ধরি কম্পাইল_পর্যন্ত_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    // প্রাথমিক বিবৃতি কম্পাইল করো
    যদি (বিবৃতি["প্রাথমিক"] != নাল) {
        ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["প্রাথমিক"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
    }
    
    ধরি লুপ_শুরু_অবস্থান = দৈর্ঘ্য(বর্তমান_নির্দেশ_পাও(কম্পাইলার));
    
    // শর্ত কম্পাইল করো
    ধরি লাফ_অবস্থান = -১;
    যদি (বিবৃতি["শর্ত"] != নাল) {
        ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["শর্ত"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
        
        লাফ_অবস্থান = নির্দেশ_নির্গমন(কম্পাইলার, অপ_লাফ_মিথ্যা, [৯৯৯৯]);
    }
    
    // দেহ কম্পাইলের আগে বৃদ্ধি অবস্থান সংরক্ষণ করো
    ধরি দেহ_শুরু_অবস্থান = দৈর্ঘ্য(বর্তমান_নির্দেশ_পাও(কম্পাইলার));
    
    // লুপ শুরু করো (continue এর জন্য)
    কম্পাইলার = লুপ_শুরু(কম্পাইলার, লুপ_শুরু_অবস্থান);
    
    // দেহ কম্পাইল করো
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["দেহ"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // বৃদ্ধি বিবৃতি কম্পাইল করো
    যদি (বিবৃতি["বৃদ্ধি"] != নাল) {
        ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["বৃদ্ধি"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
    }
    
    // লুপ শুরুতে ফিরে যাও
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_লাফ, [লুপ_শুরু_অবস্থান]);
    
    ধরি লুপ_শেষ_অবস্থান = দৈর্ঘ্য(বর্তমান_নির্দেশ_পাও(কম্পাইলার));
    
    // শর্ত লাফ প্যাচ করো
    যদি (লাফ_অবস্থান >= ০) {
        অপারেন্ড_পরিবর্তন(কম্পাইলার, লাফ_অবস্থান, [লুপ_শেষ_অবস্থান]);
    }
    
    // লুপ শেষ করো
    কম্পাইলার = লুপ_শেষ(কম্পাইলার, লুপ_শেষ_অবস্থান);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_বিরতি_বিবৃতি - বিরতি (break) কম্পাইল করো
ধরি কম্পাইল_বিরতি_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    ধরি অবস্থান = নির্দেশ_নির্গমন(কম্পাইলার, অপ_লাফ, [৯৯৯৯]);
    কম্পাইলার = বিরতি_যোগ(কম্পাইলার, অবস্থান);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_চালিয়ে_যাও_বিবৃতি - চালিয়ে_যাও (continue) কম্পাইল করো
ধরি কম্পাইল_চালিয়ে_যাও_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    ধরি অবস্থান = নির্দেশ_নির্গমন(কম্পাইলার, অপ_লাফ, [৯৯৯৯]);
    কম্পাইলার = চালিয়ে_যোগ(কম্পাইলার, অবস্থান);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_নির্ধারণ_বিবৃতি - নির্ধারণ (x = ৫) কম্পাইল করো
ধরি কম্পাইল_নির্ধারণ_বিবৃতি = ফাংশন(কম্পাইলার, বিবৃতি) {
    ধরি নাম = বিবৃতি["নাম"]["মান"];
    
    // মান কম্পাইল করো
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, বিবৃতি["মান"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // প্রতীক খোঁজো
    ধরি প্রতীক_ফলাফল = প্রতীক_খোঁজো(কম্পাইলার["প্রতীক_টেবিল"], নাম);
    যদি (!প্রতীক_ফলাফল["পাওয়া_গেছে"]) {
        ফেরত {"সফল": মিথ্যা, "কম্পাইলার": কম্পাইলার, "ত্রুটি": "অসংজ্ঞায়িত চলক: " + নাম};
    }
    
    ধরি প্রতীক = প্রতীক_ফলাফল["প্রতীক"];
    
    // সঠিক নির্দেশ নির্গমন করো
    যদি (প্রতীক["স্কোপ"] == বৈশ্বিক_স্কোপ) {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বৈশ্বিক_সেট, [প্রতীক["সূচক"]]);
    } নাহলে {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_স্থানীয়_সেট, [প্রতীক["সূচক"]]);
    }
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// =============== অভিব্যক্তি কম্পাইলেশন ===============

// কম্পাইল_পূর্ণসংখ্যা_লিটারেল - পূর্ণসংখ্যা লিটারেল কম্পাইল করো
ধরি কম্পাইল_পূর্ণসংখ্যা_লিটারেল = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    ধরি বস্তু = {"টাইপ": "INTEGER", "মান": অভিব্যক্তি["মান"]};
    ধরি সূচক = ধ্রুবক_যোগ(কম্পাইলার, বস্তু);
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_ধ্রুবক, [সূচক]);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_দশমিক_লিটারেল - দশমিক লিটারেল কম্পাইল করো
ধরি কম্পাইল_দশমিক_লিটারেল = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    ধরি বস্তু = {"টাইপ": "DOUBLE", "মান": অভিব্যক্তি["মান"]};
    ধরি সূচক = ধ্রুবক_যোগ(কম্পাইলার, বস্তু);
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_ধ্রুবক, [সূচক]);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_স্ট্রিং_লিটারেল - স্ট্রিং লিটারেল কম্পাইল করো
ধরি কম্পাইল_স্ট্রিং_লিটারেল = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    ধরি বস্তু = {"টাইপ": "STRING", "মান": অভিব্যক্তি["মান"]};
    ধরি সূচক = ধ্রুবক_যোগ(কম্পাইলার, বস্তু);
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_ধ্রুবক, [সূচক]);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_বুলিয়ান - বুলিয়ান কম্পাইল করো
ধরি কম্পাইল_বুলিয়ান = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    যদি (অভিব্যক্তি["মান"]) {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_সত্য, []);
    } নাহলে {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_মিথ্যা, []);
    }
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_শনাক্তকারী - শনাক্তকারী কম্পাইল করো
ধরি কম্পাইল_শনাক্তকারী = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    ধরি নাম = অভিব্যক্তি["মান"];
    
    ধরি প্রতীক_ফলাফল = প্রতীক_খোঁজো(কম্পাইলার["প্রতীক_টেবিল"], নাম);
    যদি (!প্রতীক_ফলাফল["পাওয়া_গেছে"]) {
        ফেরত {"সফল": মিথ্যা, "কম্পাইলার": কম্পাইলার, "ত্রুটি": "অসংজ্ঞায়িত চলক: " + নাম};
    }
    
    ধরি প্রতীক = প্রতীক_ফলাফল["প্রতীক"];
    
    // সঠিক লোড নির্দেশ নির্গমন করো
    যদি (প্রতীক["স্কোপ"] == বৈশ্বিক_স্কোপ) {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বৈশ্বিক_পাও, [প্রতীক["সূচক"]]);
    } নাহলে যদি (প্রতীক["স্কোপ"] == স্থানীয়_স্কোপ) {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_স্থানীয়_পাও, [প্রতীক["সূচক"]]);
    } নাহলে যদি (প্রতীক["স্কোপ"] == বিল্টইন_স্কোপ) {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বিল্টইন_পাও, [প্রতীক["সূচক"]]);
    } নাহলে যদি (প্রতীক["স্কোপ"] == মুক্ত_স্কোপ) {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_মুক্ত_পাও, [প্রতীক["সূচক"]]);
    } নাহলে যদি (প্রতীক["স্কোপ"] == ফাংশন_স্কোপ) {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বর্তমান_ক্লোজার, []);
    }
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_উপসর্গ_অভিব্যক্তি - উপসর্গ অভিব্যক্তি কম্পাইল করো
ধরি কম্পাইল_উপসর্গ_অভিব্যক্তি = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["ডান"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    ধরি অপারেটর = অভিব্যক্তি["অপারেটর"];
    
    যদি (অপারেটর == "-") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_ঋণাত্মক, []);
    } নাহলে যদি (অপারেটর == "!") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_না, []);
    } নাহলে যদি (অপারেটর == "~") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বিট_না, []);
    } নাহলে {
        ফেরত {"সফল": মিথ্যা, "কম্পাইলার": কম্পাইলার, "ত্রুটি": "অজানা অপারেটর: " + অপারেটর};
    }
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_মধ্যবর্তী_অভিব্যক্তি - মধ্যবর্তী অভিব্যক্তি কম্পাইল করো
ধরি কম্পাইল_মধ্যবর্তী_অভিব্যক্তি = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    ধরি অপারেটর = অভিব্যক্তি["অপারেটর"];
    
    // < অপারেটর বিশেষ ক্ষেত্রে পরিচালনা করো (> হিসাবে উল্টে দাও)
    যদি (অপারেটর == "<") {
        ধরি ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["ডান"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
        
        ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["বাম"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
        
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বড়, []);
        ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
    }
    
    যদি (অপারেটর == "<=") {
        ধরি ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["ডান"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
        
        ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["বাম"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
        
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বড়_সমান, []);
        ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
    }
    
    // সাধারণ ক্ষেত্রে: বাম, ডান, তারপর অপারেটর
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["বাম"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["ডান"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // অপারেটর অনুযায়ী নির্দেশ নির্গমন করো
    যদি (অপারেটর == "+") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_যোগ, []);
    } নাহলে যদি (অপারেটর == "-") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বিয়োগ, []);
    } নাহলে যদি (অপারেটর == "*") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_গুণ, []);
    } নাহলে যদি (অপারেটর == "/") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_ভাগ, []);
    } নাহলে যদি (অপারেটর == "%") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_ভাগশেষ, []);
    } নাহলে যদি (অপারেটর == ">") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বড়, []);
    } নাহলে যদি (অপারেটর == ">=") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বড়_সমান, []);
    } নাহলে যদি (অপারেটর == "==") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_সমান, []);
    } নাহলে যদি (অপারেটর == "!=") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_অসমান, []);
    } নাহলে যদি (অপারেটর == "&") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বিট_এবং, []);
    } নাহলে যদি (অপারেটর == "|") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বিট_অথবা, []);
    } নাহলে যদি (অপারেটর == "^") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বিট_এক্সঅর, []);
    } নাহলে যদি (অপারেটর == "<<") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_বাম_সরান, []);
    } নাহলে যদি (অপারেটর == ">>") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_ডান_সরান, []);
    } নাহলে যদি (অপারেটর == "&&") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_যৌক্তিক_এবং, []);
    } নাহলে যদি (অপারেটর == "||") {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_যৌক্তিক_অথবা, []);
    } নাহলে {
        ফেরত {"সফল": মিথ্যা, "কম্পাইলার": কম্পাইলার, "ত্রুটি": "অজানা অপারেটর: " + অপারেটর};
    }
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_যদি_অভিব্যক্তি - যদি অভিব্যক্তি কম্পাইল করো
ধরি কম্পাইল_যদি_অভিব্যক্তি = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    // শর্ত কম্পাইল করো
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["শর্ত"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // লাফ মিথ্যা নির্দেশ (বিকল্পে লাফ দাও)
    ধরি লাফ_মিথ্যা_অবস্থান = নির্দেশ_নির্গমন(কম্পাইলার, অপ_লাফ_মিথ্যা, [৯৯৯৯]);
    
    // পরিণাম কম্পাইল করো
    ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["পরিণাম"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // শেষ পপ সরাও (অপ্টিমাইজেশন)
    যদি (শেষ_নির্দেশ_কি(কম্পাইলার, অপ_পপ)) {
        শেষ_পপ_সরাও(কম্পাইলার);
    }
    
    // পরিণাম ব্লকের পরে লাফ (বিকল্প এড়িয়ে যাও)
    ধরি লাফ_অবস্থান = নির্দেশ_নির্গমন(কম্পাইলার, অপ_লাফ, [৯৯৯৯]);
    
    // লাফ মিথ্যা অবস্থান প্যাচ করো
    ধরি বিকল্প_অবস্থান = দৈর্ঘ্য(বর্তমান_নির্দেশ_পাও(কম্পাইলার));
    অপারেন্ড_পরিবর্তন(কম্পাইলার, লাফ_মিথ্যা_অবস্থান, [বিকল্প_অবস্থান]);
    
    // বিকল্প কম্পাইল করো
    যদি (অভিব্যক্তি["বিকল্প"] != নাল) {
        ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["বিকল্প"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
        
        যদি (শেষ_নির্দেশ_কি(কম্পাইলার, অপ_পপ)) {
            শেষ_পপ_সরাও(কম্পাইলার);
        }
    } নাহলে {
        // বিকল্প না থাকলে নাল পুশ করো
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_নাল, []);
    }
    
    // লাফ অবস্থান প্যাচ করো
    ধরি শেষ_অবস্থান = দৈর্ঘ্য(বর্তমান_নির্দেশ_পাও(কম্পাইলার));
    অপারেন্ড_পরিবর্তন(কম্পাইলার, লাফ_অবস্থান, [শেষ_অবস্থান]);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_ফাংশন_লিটারেল - ফাংশন লিটারেল কম্পাইল করো
ধরি কম্পাইল_ফাংশন_লিটারেল = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    // নতুন স্কোপে প্রবেশ করো
    কম্পাইলার = স্কোপ_প্রবেশ(কম্পাইলার);
    
    // প্যারামিটার সংজ্ঞায়িত করো
    ধরি প্যারামিটার = অভিব্যক্তি["প্যারামিটার"];
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(প্যারামিটার); i = i + ১) {
        ধরি নাম = প্যারামিটার[i]["মান"];
        ধরি প্রতীক_ফলাফল = প্রতীক_সংজ্ঞা(কম্পাইলার["প্রতীক_টেবিল"], নাম);
        কম্পাইলার["প্রতীক_টেবিল"] = প্রতীক_ফলাফল["টেবিল"];
    }
    
    // দেহ কম্পাইল করো
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["দেহ"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // অন্তর্নিহিত ফেরত যোগ করো
    যদি (!শেষ_নির্দেশ_কি(কম্পাইলার, অপ_মান_ফেরত)) {
        নির্দেশ_নির্গমন(কম্পাইলার, অপ_ফেরত, []);
    }
    
    // মুক্ত প্রতীক সংগ্রহ করো
    ধরি মুক্ত_প্রতীক = কম্পাইলার["প্রতীক_টেবিল"]["মুক্ত_প্রতীক"];
    ধরি স্থানীয়_সংখ্যা = প্রতীক_সংখ্যা(কম্পাইলার["প্রতীক_টেবিল"]);
    
    // স্কোপ থেকে বের হও
    ধরি স্কোপ_ফলাফল = স্কোপ_প্রস্থান(কম্পাইলার);
    কম্পাইলার = স্কোপ_ফলাফল["কম্পাইলার"];
    ধরি নির্দেশ = স্কোপ_ফলাফল["নির্দেশ"];
    
    // ফাংশন অবজেক্ট তৈরি করো
    ধরি ফাংশন_বস্তু = {
        "টাইপ": "COMPILED_FUNCTION",
        "নির্দেশ": নির্দেশ,
        "স্থানীয়_সংখ্যা": স্থানীয়_সংখ্যা,
        "প্যারামিটার_সংখ্যা": দৈর্ঘ্য(প্যারামিটার)
    };
    
    ধরি সূচক = ধ্রুবক_যোগ(কম্পাইলার, ফাংশন_বস্তু);
    
    // ক্লোজার নির্দেশ নির্গমন করো
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_ক্লোজার, [সূচক, দৈর্ঘ্য(মুক্ত_প্রতীক)]);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_কল_অভিব্যক্তি - কল অভিব্যক্তি কম্পাইল করো
ধরি কম্পাইল_কল_অভিব্যক্তি = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    // ফাংশন কম্পাইল করো
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["ফাংশন"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // আর্গুমেন্ট কম্পাইল করো
    ধরি আর্গুমেন্ট = অভিব্যক্তি["আর্গুমেন্ট"];
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(আর্গুমেন্ট); i = i + ১) {
        ফলাফল = কম্পাইল(কম্পাইলার, আর্গুমেন্ট[i]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
    }
    
    // কল নির্দেশ নির্গমন করো
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_কল, [দৈর্ঘ্য(আর্গুমেন্ট)]);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_অ্যারে_লিটারেল - অ্যারে লিটারেল কম্পাইল করো
ধরি কম্পাইল_অ্যারে_লিটারেল = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    ধরি উপাদান = অভিব্যক্তি["উপাদান"];
    
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(উপাদান); i = i + ১) {
        ধরি ফলাফল = কম্পাইল(কম্পাইলার, উপাদান[i]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
    }
    
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_অ্যারে, [দৈর্ঘ্য(উপাদান)]);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_হ্যাশ_লিটারেল - হ্যাশ লিটারেল কম্পাইল করো
ধরি কম্পাইল_হ্যাশ_লিটারেল = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    ধরি জোড়া = অভিব্যক্তি["জোড়া"];
    ধরি জোড়া_সংখ্যা = ০;
    
    // সব key-value জোড়া কম্পাইল করো
    ধরি চাবি_তালিকা = চাবি_সব(জোড়া);
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(চাবি_তালিকা); i = i + ১) {
        ধরি চাবি = চাবি_তালিকা[i];
        ধরি জোড়া_বস্তু = জোড়া[চাবি];
        
        // কী কম্পাইল করো
        ধরি ফলাফল = কম্পাইল(কম্পাইলার, জোড়া_বস্তু["কী"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
        
        // মান কম্পাইল করো
        ফলাফল = কম্পাইল(কম্পাইলার, জোড়া_বস্তু["মান"]);
        যদি (!ফলাফল["সফল"]) {
            ফেরত ফলাফল;
        }
        কম্পাইলার = ফলাফল["কম্পাইলার"];
        
        জোড়া_সংখ্যা = জোড়া_সংখ্যা + ১;
    }
    
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_হ্যাশ, [জোড়া_সংখ্যা * ২]);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// কম্পাইল_সূচক_অভিব্যক্তি - সূচক অভিব্যক্তি কম্পাইল করো
ধরি কম্পাইল_সূচক_অভিব্যক্তি = ফাংশন(কম্পাইলার, অভিব্যক্তি) {
    // বাম কম্পাইল করো
    ধরি ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["বাম"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    // সূচক কম্পাইল করো
    ফলাফল = কম্পাইল(কম্পাইলার, অভিব্যক্তি["সূচক"]);
    যদি (!ফলাফল["সফল"]) {
        ফেরত ফলাফল;
    }
    কম্পাইলার = ফলাফল["কম্পাইলার"];
    
    নির্দেশ_নির্গমন(কম্পাইলার, অপ_সূচক, []);
    
    ফেরত {"সফল": সত্য, "কম্পাইলার": কম্পাইলার, "ত্রুটি": ""};
};

// =============== বাইটকোড নিষ্কাশন ===============

// বাইটকোড_পাও - চূড়ান্ত বাইটকোড পাও
ধরি বাইটকোড_পাও = ফাংশন(কম্পাইলার) {
    ফেরত {
        "নির্দেশ": বর্তমান_নির্দেশ_পাও(কম্পাইলার),
        "ধ্রুবক": কম্পাইলার["ধ্রুবক"]
    };
};

// চাবি_সব - হ্যাশ থেকে সব চাবি পাও (helper function)
ধরি চাবি_সব = ফাংশন(হ্যাশ) {
    ধরি তালিকা = [];
    ধরি কাউন্টার = ০;
    
    যতক্ষণ (সত্য) {
        ধরি খুঁজে_পাওয়া = মিথ্যা;
        
        // ০-৯ অঙ্ক পরীক্ষা করো
        পর্যন্ত (ধরি i = ০; i <= ৯; i = i + ১) {
            ধরি কী = লেখা(i);
            যদি (চাবি_আছে(হ্যাশ, কী) && !তালিকায়_আছে(তালিকা, কী)) {
                তালিকা = যোগ(তালিকা, কী);
                খুঁজে_পাওয়া = সত্য;
                বিরতি;
            }
        }
        
        যদি (!খুঁজে_পাওয়া) {
            বিরতি;
        }
        
        কাউন্টার = কাউন্টার + ১;
        যদি (কাউন্টার > ১০০) {
            বিরতি;
        }
    }
    
    ফেরত তালিকা;
};

// তালিকায়_আছে - তালিকায় উপাদান আছে কি না (helper function)
ধরি তালিকায়_আছে = ফাংশন(তালিকা, উপাদান) {
    পর্যন্ত (ধরি i = ০; i < দৈর্ঘ্য(তালিকা); i = i + ১) {
        যদি (তালিকা[i] == উপাদান) {
            ফেরত সত্য;
        }
    }
    ফেরত মিথ্যা;
};

লেখ("কম্পাইলার মডিউল লোড হয়েছে");

