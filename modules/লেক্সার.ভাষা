// লেক্সার মডিউল - ভাষা স্ব-হোস্টিং কম্পাইলারের জন্য
// সম্পূর্ণ ইউনিকোড সমর্থন সহ লেক্সিক্যাল বিশ্লেষক

অন্তর্ভুক্ত "modules/টোকেন";

// নতুন_লেক্সার - নতুন লেক্সার তৈরি করো
ধরি নতুন_লেক্সার = ফাংশন(ইনপুট) {
    ধরি লেক্সার = {
        "ইনপুট": ইনপুট,
        "অবস্থান": ০,
        "পরবর্তী_অবস্থান": ০,
        "অক্ষর": "",
        "লাইন": ১,
        "কলাম": ০,
        "দৈর্ঘ্য": দৈর্ঘ্য(ইনপুট)
    };
    
    // প্রথম অক্ষর পড়ো
    লেক্সার = অক্ষর_পড়ো(লেক্সার);
    
    ফেরত লেক্সার;
};

// অক্ষর_পড়ো - পরবর্তী অক্ষর পড়ো
ধরি অক্ষর_পড়ো = ফাংশন(লেক্সার) {
    যদি (লেক্সার["পরবর্তী_অবস্থান"] >= লেক্সার["দৈর্ঘ্য"]) {
        লেক্সার["অক্ষর"] = "";
    } নাহলে {
        লেক্সার["অক্ষর"] = অক্ষর(লেক্সার["ইনপুট"], লেক্সার["পরবর্তী_অবস্থান"]);
    }
    
    লেক্সার["অবস্থান"] = লেক্সার["পরবর্তী_অবস্থান"];
    লেক্সার["পরবর্তী_অবস্থান"] = লেক্সার["পরবর্তী_অবস্থান"] + ১;
    লেক্সার["কলাম"] = লেক্সার["কলাম"] + ১;
    
    ফেরত লেক্সার;
};

// উঁকি_দাও - পরবর্তী অক্ষর দেখো (পড়ো না)
ধরি উঁকি_দাও = ফাংশন(লেক্সার) {
    যদি (লেক্সার["পরবর্তী_অবস্থান"] >= লেক্সার["দৈর্ঘ্য"]) {
        ফেরত "";
    }
    ফেরত অক্ষর(লেক্সার["ইনপুট"], লেক্সার["পরবর্তী_অবস্থান"]);
};

// ফাঁকা_স্থান_এড়াও - ফাঁকা স্থান এড়িয়ে যাও
ধরি ফাঁকা_স্থান_এড়াও = ফাংশন(লেক্সার) {
    যতক্ষণ (ফাঁকা_স্থান_কিনা(লেক্সার["অক্ষর"])) {
        // নতুন লাইনের জন্য লাইন ট্র্যাকিং
        যদি (কোড(লেক্সার["অক্ষর"]) == ১০) {
            লেক্সার["লাইন"] = লেক্সার["লাইন"] + ১;
            লেক্সার["কলাম"] = ০;
        }
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    }
    ফেরত লেক্সার;
};

// মন্তব্য_এড়াও - একক লাইনের মন্তব্য এড়িয়ে যাও (//)
ধরি মন্তব্য_এড়াও = ফাংশন(লেক্সার) {
    // লাইনের শেষ বা ফাইলের শেষ পর্যন্ত এড়াও
    যতক্ষণ (লেক্সার["অক্ষর"] != "" && কোড(লেক্সার["অক্ষর"]) != ১০) {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    }
    ফেরত লেক্সার;
};

// শনাক্তকারী_পড়ো - শনাক্তকারী বা কীওয়ার্ড পড়ো
ধরি শনাক্তকারী_পড়ো = ফাংশন(লেক্সার) {
    ধরি শুরু_অবস্থান = লেক্সার["অবস্থান"];
    
    যতক্ষণ (বর্ণ_কিনা(লেক্সার["অক্ষর"])) {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    }
    
    ধরি শেষ_অবস্থান = লেক্সার["অবস্থান"];
    ধরি লিটারেল = "";
    
    // সাবস্ট্রিং বের করো
    পর্যন্ত (ধরি i = শুরু_অবস্থান; i < শেষ_অবস্থান; i = i + ১) {
        লিটারেল = লিটারেল + অক্ষর(লেক্সার["ইনপুট"], i);
    }
    
    ফেরত {"লেক্সার": লেক্সার, "লিটারেল": লিটারেল};
};

// সংখ্যা_পড়ো - সংখ্যা পড়ো (পূর্ণসংখ্যা বা দশমিক)
ধরি সংখ্যা_পড়ো = ফাংশন(লেক্সার) {
    ধরি শুরু_অবস্থান = লেক্সার["অবস্থান"];
    ধরি দশমিক_আছে = মিথ্যা;
    
    যতক্ষণ (অঙ্ক_কিনা(লেক্সার["অক্ষর"]) || লেক্সার["অক্ষর"] == ".") {
        যদি (লেক্সার["অক্ষর"] == ".") {
            // দেখো ইতিমধ্যে দশমিক বিন্দু আছে কিনা
            যদি (দশমিক_আছে) {
                বিরতি;  // একাধিক দশমিক বিন্দু সহ অবৈধ সংখ্যা
            }
            দশমিক_আছে = সত্য;
            
            // সামনে দেখো পরবর্তী অক্ষর অঙ্ক কিনা
            ধরি পরবর্তী = উঁকি_দাও(লেক্সার);
            যদি (!অঙ্ক_কিনা(পরবর্তী)) {
                বিরতি;  // '.' সংখ্যার অংশ নয়
            }
        }
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    }
    
    ধরি শেষ_অবস্থান = লেক্সার["অবস্থান"];
    ধরি লিটারেল = "";
    
    // সাবস্ট্রিং বের করো
    পর্যন্ত (ধরি i = শুরু_অবস্থান; i < শেষ_অবস্থান; i = i + ১) {
        লিটারেল = লিটারেল + অক্ষর(লেক্সার["ইনপুট"], i);
    }
    
    // বাংলা অঙ্ক ইংরেজি অঙ্কে রূপান্তর করো
    লিটারেল = বাংলা_সংখ্যা_রূপান্তর(লিটারেল);
    
    ধরি টোকেন_টাইপ = পূর্ণসংখ্যা_টোকেন;
    যদি (দশমিক_আছে) {
        টোকেন_টাইপ = দশমিক_টোকেন;
    }
    
    ফেরত {"লেক্সার": লেক্সার, "লিটারেল": লিটারেল, "টাইপ": টোকেন_টাইপ};
};

// স্ট্রিং_পড়ো - স্ট্রিং লিটারেল পড়ো
ধরি স্ট্রিং_পড়ো = ফাংশন(লেক্সার) {
    ধরি শুরু_অবস্থান = লেক্সার["অবস্থান"] + ১;  // শুরুর কোট এড়াও
    ধরি লিটারেল = "";
    
    লেক্সার = অক্ষর_পড়ো(লেক্সার);
    
    যতক্ষণ (লেক্সার["অক্ষর"] != "\"" && লেক্সার["অক্ষর"] != "") {
        // এস্কেপ সিকোয়েন্স সামলাও
        যদি (লেক্সার["অক্ষর"] == "\\") {
            লেক্সার = অক্ষর_পড়ো(লেক্সার);
            
            // সাধারণ এস্কেপ সিকোয়েন্স
            যদি (লেক্সার["অক্ষর"] == "n") {
                লিটারেল = লিটারেল + অক্ষর_থেকে_কোড(১০);  // নিউলাইন
            } নাহলে যদি (লেক্সার["অক্ষর"] == "t") {
                লিটারেল = লিটারেল + অক্ষর_থেকে_কোড(৯);   // ট্যাব
            } নাহলে যদি (লেক্সার["অক্ষর"] == "r") {
                লিটারেল = লিটারেল + অক্ষর_থেকে_কোড(১৩);  // ক্যারিজ রিটার্ন
            } নাহলে যদি (লেক্সার["অক্ষর"] == "\\") {
                লিটারেল = লিটারেল + "\\";
            } নাহলে যদি (লেক্সার["অক্ষর"] == "\"") {
                লিটারেল = লিটারেল + "\"";
            } নাহলে {
                // অজানা এস্কেপ, শুধু অক্ষর যোগ করো
                লিটারেল = লিটারেল + লেক্সার["অক্ষর"];
            }
        } নাহলে {
            লিটারেল = লিটারেল + লেক্সার["অক্ষর"];
        }
        
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    }
    
    যদি (লেক্সার["অক্ষর"] == "") {
        // অসম্পূর্ণ স্ট্রিং
        ফেরত {"লেক্সার": লেক্সার, "লিটারেল": "", "ত্রুটি": "অসম্পূর্ণ স্ট্রিং"};
    }
    
    লেক্সার = অক্ষর_পড়ো(লেক্সার);  // শেষের কোট এড়াও
    
    ফেরত {"লেক্সার": লেক্সার, "লিটারেল": লিটারেল};
};

// পরবর্তী_টোকেন - পরবর্তী টোকেন পাও
ধরি পরবর্তী_টোকেন = ফাংশন(লেক্সার) {
    লেক্সার = ফাঁকা_স্থান_এড়াও(লেক্সার);
    
    ধরি লাইন = লেক্সার["লাইন"];
    ধরি কলাম = লেক্সার["কলাম"];
    ধরি অক্ষর_মান = লেক্সার["অক্ষর"];
    ধরি টোকেন = নাল;
    
    // ফাইলের শেষ সামলাও
    যদি (অক্ষর_মান == "") {
        টোকেন = নতুন_টোকেন(শেষ, "", লাইন, কলাম);
        ফেরত {"লেক্সার": লেক্সার, "টোকেন": টোকেন};
    }
    
    ধরি কোড_মান = কোড(অক্ষর_মান);
    
    // মন্তব্য সামলাও
    যদি (অক্ষর_মান == "/" && উঁকি_দাও(লেক্সার) == "/") {
        লেক্সার = মন্তব্য_এড়াও(লেক্সার);
        ফেরত পরবর্তী_টোকেন(লেক্সার);  // পুনরাবৃত্তিমূলকভাবে পরবর্তী টোকেন পাও
    }
    
    // দুই-অক্ষরের অপারেটর
    যদি (অক্ষর_মান == "=" && উঁকি_দাও(লেক্সার) == "=") {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        টোকেন = নতুন_টোকেন(সমান_সমান, "==", লাইন, কলাম);
    } নাহলে যদি (অক্ষর_মান == "!" && উঁকি_দাও(লেক্সার) == "=") {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        টোকেন = নতুন_টোকেন(অসমান, "!=", লাইন, কলাম);
    } নাহলে যদি (অক্ষর_মান == "<" && উঁকি_দাও(লেক্সার) == "=") {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        টোকেন = নতুন_টোকেন(ছোট_সমান, "<=", লাইন, কলাম);
    } নাহলে যদি (অক্ষর_মান == ">" && উঁকি_দাও(লেক্সার) == "=") {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        টোকেন = নতুন_টোকেন(বড়_সমান, ">=", লাইন, কলাম);
    } নাহলে যদি (অক্ষর_মান == "<" && উঁকি_দাও(লেক্সার) == "<") {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        টোকেন = নতুন_টোকেন(বাম_সরান, "<<", লাইন, কলাম);
    } নাহলে যদি (অক্ষর_মান == ">" && উঁকি_দাও(লেক্সার) == ">") {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        টোকেন = নতুন_টোকেন(ডান_সরান, ">>", লাইন, কলাম);
    } নাহলে যদি (অক্ষর_মান == "&" && উঁকি_দাও(লেক্সার) == "&") {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        টোকেন = নতুন_টোকেন(এবং, "&&", লাইন, কলাম);
    } নাহলে যদি (অক্ষর_মান == "|" && উঁকি_দাও(লেক্সার) == "|") {
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
        টোকেন = নতুন_টোকেন(অথবা, "||", লাইন, কলাম);
    }
    // এক-অক্ষরের অপারেটর এবং বিভাজক
    নাহলে যদি (অক্ষর_মান == "=") {
        টোকেন = নতুন_টোকেন(সমান, "=", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "+") {
        টোকেন = নতুন_টোকেন(যোগ, "+", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "-") {
        টোকেন = নতুন_টোকেন(বিয়োগ, "-", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "!") {
        টোকেন = নতুন_টোকেন(না, "!", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "*") {
        টোকেন = নতুন_টোকেন(গুণ, "*", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "/") {
        টোকেন = নতুন_টোকেন(ভাগ, "/", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "%") {
        টোকেন = নতুন_টোকেন(ভাগশেষ, "%", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "<") {
        টোকেন = নতুন_টোকেন(ছোট, "<", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == ">") {
        টোকেন = নতুন_টোকেন(বড়, ">", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "&") {
        টোকেন = নতুন_টোকেন(বিট_এবং, "&", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "|") {
        টোকেন = নতুন_টোকেন(বিট_অথবা, "|", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "^") {
        টোকেন = নতুন_টোকেন(বিট_এক্সঅর, "^", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "~") {
        টোকেন = নতুন_টোকেন(বিট_না, "~", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == ",") {
        টোকেন = নতুন_টোকেন(কমা, ",", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == ";") {
        টোকেন = নতুন_টোকেন(সেমিকোলন, ";", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == ":") {
        টোকেন = নতুন_টোকেন(কোলন, ":", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "(") {
        টোকেন = নতুন_টোকেন(প্রথম_বন্ধনী_শুরু, "(", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == ")") {
        টোকেন = নতুন_টোকেন(প্রথম_বন্ধনী_শেষ, ")", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "{") {
        টোকেন = নতুন_টোকেন(দ্বিতীয়_বন্ধনী_শুরু, "{", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "}") {
        টোকেন = নতুন_টোকেন(দ্বিতীয়_বন্ধনী_শেষ, "}", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "[") {
        টোকেন = নতুন_টোকেন(তৃতীয়_বন্ধনী_শুরু, "[", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "]") {
        টোকেন = নতুন_টোকেন(তৃতীয়_বন্ধনী_শেষ, "]", লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    } নাহলে যদি (অক্ষর_মান == "\"") {
        // স্ট্রিং লিটারেল
        ধরি ফলাফল = স্ট্রিং_পড়ো(লেক্সার);
        যদি (চাবি_আছে(ফলাফল, "ত্রুটি")) {
            টোকেন = নতুন_টোকেন(অবৈধ, ফলাফল["লিটারেল"], লাইন, কলাম);
        } নাহলে {
            টোকেন = নতুন_টোকেন(স্ট্রিং_টোকেন, ফলাফল["লিটারেল"], লাইন, কলাম);
        }
        লেক্সার = ফলাফল["লেক্সার"];
    } নাহলে যদি (বর্ণ_কিনা(অক্ষর_মান)) {
        // শনাক্তকারী বা কীওয়ার্ড
        ধরি ফলাফল = শনাক্তকারী_পড়ো(লেক্সার);
        লেক্সার = ফলাফল["লেক্সার"];
        ধরি লিটারেল = ফলাফল["লিটারেল"];
        ধরি টোকেন_টাইপ = শনাক্তকারী_খুঁজো(লিটারেল);
        টোকেন = নতুন_টোকেন(টোকেন_টাইপ, লিটারেল, লাইন, কলাম);
    } নাহলে যদি (অঙ্ক_কিনা(অক্ষর_মান)) {
        // সংখ্যা
        ধরি ফলাফল = সংখ্যা_পড়ো(লেক্সার);
        লেক্সার = ফলাফল["লেক্সার"];
        টোকেন = নতুন_টোকেন(ফলাফল["টাইপ"], ফলাফল["লিটারেল"], লাইন, কলাম);
    } নাহলে {
        // অবৈধ অক্ষর
        টোকেন = নতুন_টোকেন(অবৈধ, অক্ষর_মান, লাইন, কলাম);
        লেক্সার = অক্ষর_পড়ো(লেক্সার);
    }
    
    ফেরত {"লেক্সার": লেক্সার, "টোকেন": টোকেন};
};

// সব_টোকেন_করো - সম্পূর্ণ ইনপুট টোকেনাইজ করো
ধরি সব_টোকেন_করো = ফাংশন(ইনপুট) {
    ধরি লেক্সার = নতুন_লেক্সার(ইনপুট);
    ধরি টোকেন_তালিকা = [];
    
    যতক্ষণ (সত্য) {
        ধরি ফলাফল = পরবর্তী_টোকেন(লেক্সার);
        লেক্সার = ফলাফল["লেক্সার"];
        ধরি টোকেন = ফলাফল["টোকেন"];
        
        টোকেন_তালিকা = যোগ(টোকেন_তালিকা, টোকেন);
        
        যদি (টোকেন["টাইপ"] == শেষ) {
            বিরতি;
        }
    }
    
    ফেরত টোকেন_তালিকা;
};

লেখ("লেক্সার মডিউল লোড হয়েছে");
